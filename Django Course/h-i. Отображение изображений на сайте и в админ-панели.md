Атрибуты и методы, доступные для полей типов файла или изображения

Зачем нужна переменная MEDIA_URL

Зачем выполнять связывание

Добавляем изображение на сайт

Отображение и редактирование фото в админ-панели

### Атрибуты и методы, доступные для полей типов файла или изображения

1. **Атрибуты**:
    - `name` - возвращает имя файла.
    - `size` - возвращает размер файла в байтах.
    - `url` - возвращает URL-адрес для доступа к файлу.
    - `path` - возвращает абсолютный путь к файлу на файловой системе.
    - `created_at` - возвращает дату и время создания файла.
    - `modified_at` - возвращает дату и время последнего изменения файла.
2. **Методы**:
    - `open(mode='rb')` - открывает файл в указанном режиме (по умолчанию - только для чтения).
    - `close()` - закрывает открытый файл.
    - `read([size])` - читает содержимое файла. Если указан `size`, читает не более `size` байт.
    - `write(content)` - записывает `content` в файл.
    - `seek(offset[, whence])` - устанавливает позицию указателя файла.
    - `tell()` - возвращает текущую позицию указателя файла.

Дополнительно, для полей типа `ImageField` доступны следующие атрибуты:

- `width` - возвращает ширину изображения в пикселях.
- `height` - возвращает высоту изображения в пикселях.
- `content_type` - возвращает MIME-тип изображения.

### **Зачем нужна переменная MEDIA_URL**

`MEDIA_URL` - это переменная, которая определяет публичный URL-префикс, используемый для доступа к загруженным медиафайлам. Она используется вместе с `MEDIA_ROOT` для построения правильных URL-адресов для доступа к файлам.

Основные задачи `MEDIA_URL`:

- **Построение URL-адресов**: Django использует `MEDIA_URL` для генерации корректных URL-адресов для доступа к загруженным файлам. Например, при использовании `{{ instance.image.url }}` в шаблоне, будет сгенерирован URL, основанный на `MEDIA_URL`.
- **Настройка веб-сервера**: `MEDIA_URL` помогает правильно настроить веб-сервер (например, Nginx) для обработки запросов к медиафайлам. Сервер должен быть настроен на обработку запросов к `MEDIA_URL`.
- **Безопасность**: Разделение статических файлов приложения и пользовательских медиафайлов через `MEDIA_URL` помогает обеспечить безопасность, ограничивая доступ к критически важным файлам приложения.

### **Зачем выполнять связывание**

```Python
# urls.py
if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

Это связывание необходимо для того, чтобы Django мог правильно обрабатывать запросы к медиафайлам во время разработки (в режиме `DEBUG=True`).

Когда `DEBUG=True`, Django предоставляет встроенный механизм для обработки статических файлов (включая медиафайлы), используя `django.contrib.staticfiles.views.serve()`. Этот механизм позволяет Django обрабатывать запросы к медиафайлам, не полагаясь на внешний веб-сервер.

Однако, в production-окружении (когда `DEBUG=False`) это связывание не нужно, так как обычно медиафайлы обрабатываются внешним веб-сервером (например, Nginx), который должен быть настроен на обработку запросов к `MEDIA_URL`.

### Добавляем изображение на сайт

В шаблоне прописываем дополнительное условие, чтобы отобразить изображение, если оно есть у объекта. Используем для этого тег - `img` и путь к изображению, полученный из атрибута поля иозражения (например, post.photo.url)

Тег `<img>` в HTML используется для вставки изображения на веб-страницу.

**Основные атрибуты и возможности этого тега:**

1. **Атрибуты**:
    - `src` (обязательный) - указывает путь к изображению, которое необходимо отобразить.
    - `alt` (обязательный) - описательный текст для изображения, который будет отображаться, если изображение не может быть загружено.
    - `width` и `height` - устанавливают ширину и высоту изображения в пикселях или процентах.
    - `title` - добавляет всплывающую подсказку при наведении на изображение.
    - `class` и `id` - позволяют применять стили и JavaScript-обработчики к изображению.
    - `loading` - задает способ загрузки изображения (например, `lazy` для отложенной загрузки).
2. **Возможности**:
    - Отображение статических изображений, таких как JPG, PNG, GIF, SVG.
    - Встраивание динамических изображений, генерируемых на сервере.
    - Использование изображений в качестве ссылок (`<a href="..."><img src="..."></a>`).
    - Применение стилей для изменения размера, положения, обрамления изображений.
    - Управление отображением изображений с помощью JavaScript (показ/скрытие, анимация и т.д.).
    - Поддержка отзывчивого дизайна с использованием `srcset` и `sizes` атрибутов.

**Пример использования данного тега в шаблоне:**

```HTML
{% if post.photo %}
<img class="img-article-left" src="{{post.photo.url}}" alt="{{post.title}}"></p>
{% endif %}
```

### Отображение и редактирование фото в админ-панели

1. Чтобы видеть путь к изображению и иметь возможность его редактировать, достаточно добавить новый атрибут photo в `list_display` (отображение пути в списке объектов) и `fields` (возможность редактировать путь через карточку объекта).
2. Для того же, чтобы видеть именно миниатюрку в админ панели, нужно создать новое [[g-c. Вычисляемые поля и пользовательские действия в админ-панели]] и добавить его в `list_display` (отображение миниатюрки в списке объектов) или `fields` и `readonly_fields` (отображение миниатюрки в карточке объекта).
    
    Пример вычисляемого поля:
    
    ```Python
    from django.utils.safestring import mark_safe
    
    @admin.register(Post)
    class PostAdmin(admin.ModelAdmin):
        list_display = ('title', 'show_photo', 'photo', 'show_pub', 'cat')
        list_display_links = ('title',)
        ordering = ('title',)
        fields = ('title', 'content', 'show_photo', 'photo', 'cat', 'tags')
        readonly_fields = ('show_photo',)
    
        @admin.display(description='Фото')
        def show_photo(self, women:Post):
            if women.photo:
                return mark_safe(f'<img src="{women.photo.url}" alt="Фото для {women.title}" width=70')
    ```
    
    Где:
    
    - Функция `mark_safe()` используется, чтобы разрешить отображение HTML-кода в поле `show_photo`. Без этой функции, Django будет экранировать HTML-теги, и вместо изображения будет отображаться HTML-код.
    - Без добавления `show_photo` в `readonly_fields`, Django будет пытаться отобразить это поле как обычное текстовое поле ввода, вместо отображения фактического изображения. Добавляя `show_photo` в `readonly_fields`, вы сообщаете Django, что это поле должно быть отображено в режиме "только для чтения", без возможности редактирования. Таким образом, Django будет корректно отображать HTML-код, возвращаемый методом `show_photo`.

<div class="page-break" style="page-break-before: always;"></div>
