Описание

Ресурсы для ознакомления

Настройки шаблонизатора

Правила размещения шаблонов в проекте

Поиск шаблона в проекте

Функция render_to_string

Функция render

### Описание

**Шаблоны** (в контексте Django) – это основа для создания динамических HTML-страниц. По своей сути, они представляют собой текстовые файлы с особым синтаксисом, сочетающим статический HTML с переменными и управляющей логикой Django.

**Преимущества:**

- **Разделение ответственности:** Шаблоны отделяют логику представления от бизнес-логики, делая код более читаемым и поддерживаемым.
- **Динамичность:** Шаблоны позволяют генерировать HTML-код на основе данных из приложения, что делает страницы более персонализированными и интерактивными.
- **Повторное использование:** Шаблоны можно использовать повторно в разных частях приложения, что экономит время и усилия.

**Структура:**

- **Файлы шаблонов:** Обычные текстовые файлы с расширением `.html`, содержащие HTML-код, переменные и теги Django.
- **Переменные:** Заполнители, которые заменяются значениями из контекста во время выполнения.
- **Теги:** Специальные команды, которые управляют логикой шаблона, например, циклами, условными операторами и форматированием.

### **Ресурсы для ознакомления**

> [!info] Django  
> The web framework for perfectionists with deadlines.  
> [https://docs.djangoproject.com/en/4.2/topics/templates/](https://docs.djangoproject.com/en/4.2/topics/templates/)  

> [!info] Jinja2 \#1: О шаблонизаторе, использование {{ }} в шаблонах  
> Инфо-сайт: https://proproprogs.  
> [https://www.youtube.com/watch?v=cFJqMXxVNsI&list=PLA0M1Bcd0w8wfmtElObQrBbZjY6XeA06U](https://www.youtube.com/watch?v=cFJqMXxVNsI&list=PLA0M1Bcd0w8wfmtElObQrBbZjY6XeA06U)  

> [!info] 19 Часть 1. Jinja2. Основы  
> 00:00:00 Jinja2  
> [https://youtu.be/IMLCji3XIQo?si=I_XtGRLfTfiVUVUD](https://youtu.be/IMLCji3XIQo?si=I_XtGRLfTfiVUVUD)  

### **Настройки шаблонизатора**

**Переменная TEMPLATES:**

- Находится в файле `settings.py` проекта Django.
- Определяет конфигурацию шаблонизатора Django.
- Содержит список словарей, где каждый словарь описывает один движок шаблонов.

**Ключи словаря:**

- **BACKEND:** (обязательный) Тип движка шаблонов.
- **DIRS:** (необязательный) Список каталогов, где движок будет искать файлы шаблонов.
- **APP_DIRS:** (необязательный) Флаг, который указывает, должен ли движок искать шаблоны в папках `templates` приложений. **Важно**! При этом само приложение должно быть прописано в `INSTALLED_APPS`.
- **OPTIONS:** (необязательный) Словарь дополнительных параметров для движка шаблонов.

**Доступные движки шаблонов:**

- **django.template.backends.django.DjangoTemplates:** Движок по умолчанию, который использует язык шаблонов Django.
- **django.template.backends.jinja2.Jinja2:** Движок, который использует язык шаблонов Jinja2.
    
    > _Django позволяет использовать несколько движков шаблонов одновременно.  
    > Настройки шаблонизатора могут быть переопределены в приложениях.  
    > Существуют сторонние библиотеки, которые добавляют новые функции в систему шаблонизации Django.  
    > _
    

### **Правила размещения шаблонов в проекте**

**1. Структура:**

- Шаблоны Django обычно размещаются в папке `templates`.
- Внутри папки `templates` можно создавать подпапки для организации шаблонов по приложениям, функциональности или другим критериям.
- Django позволяет размещать шаблоны в **любых** папках на файловой системе.
- Для этого необходимо добавить эти папки в список `DIRS` в настройках шаблонизатора (`settings.py`).

**2. Имена файлов:**

- Файлы шаблонов должны иметь расширение `.html`.
- Имена файлов должны быть краткими, понятными и отражать содержимое шаблона.

**3. Наследование шаблонов:**

- Шаблоны могут наследоваться друг от друга.
- Это позволяет использовать общие элементы оформления и логики в разных шаблонах.
- Шаблон-наследник должен находиться в той же папке, что и базовый шаблон, или в подпапке.

### **Поиск шаблона в проекте**

**1. Алгоритм:**

- Django сначала ищет шаблон в папках, указанных в списке `DIRS` в настройках шаблонизатора (`settings.py`).
- Если шаблон не найден, Django ищет его в папках `templates` всех установленных приложений (при этом порядок приложений будет аналогичен порядку перечисления приложений в переменной `INSTALLED_APPS`).
- Если шаблон не найден ни в одном из этих мест, Django выводит ошибку - `TemplateDoesNotExist`.

**2. Приоритет:**

- Django отдает предпочтение шаблонам, найденным в папках, указанных в списке `DIRS`.
- Если шаблон найден в нескольких папках, Django использует первый найденный шаблон. Чтобы избежать проблемы одинакового нейминга шаблонов, рекомендуется создавать подпапки с названием приложения в папке с шаблонами, и указывать путь до шаблона, начиная с этой подпапки, например, `‘basefunc/index.html’` при следующей структуре приложения:
    
    ![[Untitled 5 1.png|Untitled 5 1.png]]
    

**3. Кэширование:**

- Django кэширует шаблоны после их первого использования.
- Это повышает производительность, так как Django не нужно каждый раз искать шаблон на диске.

**4. Настройка:**

- Можно изменить алгоритм поиска шаблонов, переопределив метод `get_template()` в представлении.
    
    - Принимает два аргумента:
        - `template_name`: имя шаблона.
        - `template_dirs`: список папок, в которых Django будет искать шаблон.
    
    **Пример:**
    
    ```Python
    from django.template.loader import get_template
    
    def my_view(request):
        # Изменяем алгоритм поиска шаблона.
        template = get_template('my_template.html', template_dirs=['/path/to/custom/templates'])
        return render(request, template)
    ```
    
    **В этом примере:**
    
    - Django будет искать шаблон `my_template.html` в папке `/path/to/custom/templates`.
    - Django **не** будет искать шаблон в папках, указанных в списке `DIRS`.
    - Django **не** будет искать шаблон в папках `templates` приложений.

**5. Отладка:**

- Если Django не может найти шаблон, он выводит подробное сообщение об ошибке.
- Это сообщение об ошибке содержит информацию о том, где Django искал шаблон.

### **Функция** `**render_to_string**`

- Функция `render_to_string` используется для рендеринга шаблона Django в строку.
- Это может быть полезно, если вам нужно:
    - Вставить шаблон в другой шаблон.
    - Отправить шаблон по электронной почте.
    - Сохранить шаблон в файл.

**Синтаксис:**

```Python
from django.template.loader import render_to_string

render_to_string(template_name, context=None, request=None, using=None)
```

**Аргументы:**

- `template_name`: имя шаблона.
- `context`: контекст, который будет передан в шаблон (необязательный).
- `request`: объект запроса (необязательный).
- `using`: строка, представляющая имя используемого движка шаблонов. По умолчанию используется основной движок шаблонов.

**Пример:**

```Python
from django.template.loader import render_to_string


def my_view(request):
    context = {'name': 'John Doe'}
    # Рендерим шаблон 'my_template.html' в строку.
    html_string = render_to_string('my_template.html', context)
    return HttpResponse(html_string)
```

**В этом примере:**

- Функция `render_to_string` рендерит шаблон `my_template.html` с контекстом `{'name': 'John Doe'}`.
- Результат рендеринга (строка HTML) возвращается в качестве ответа.

### **Функция** `**render**`

- Функция `render` используется для рендеринга HTML-шаблонов и возврата объекта `HttpResponse`.
- Это основная функция, используемая для отображения страниц в Django.

**Синтаксис:**

```Python
from django.shortcuts import render

render(request, template_name, context=None, content_type=None, status=None, using=None)
```

**Аргументы:**

- `**request**`: Обязательный параметр, объект запроса `**HttpRequest**`.
- `**template_name**`: Обязательный параметр, строка, представляющая имя шаблона, который нужно отрендерить.
- `**context**`: Опциональный параметр, словарь, представляющий контекст, который будет передан в шаблон для его рендеринга.
- `**content_type**`: Опциональный параметр, строка, представляющая тип содержимого ответа. По умолчанию устанавливается как `**'text/html'**`.
- `**status**`: Опциональный параметр, целое число, представляющее код состояния HTTP ответа. По умолчанию устанавливается как `**200**` (OK).
- `**using**`: Опциональный параметр, строка, представляющая имя используемого движка шаблонов. По умолчанию используется основной движок шаблонов.

**Пример:**

```Python
from django.shortcuts import render

def my_view(request):
    context = {'name': 'John Doe'}
    # Рендерим шаблон 'my_template.html' и возвращаем HTTP-ответ.
    return render(request, 'my_template.html', context)
```

**В этом примере:**

- Функция `render` рендерит шаблон `my_template.html` с контекстом `{'name': 'John Doe'}`.
- Результат рендеринга (HTML) используется для создания HTTP-ответа.

<div class="page-break" style="page-break-before: always;"></div>
