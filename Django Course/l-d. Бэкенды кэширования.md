PyMemcacheCache

RedisCache

DatabaseCache

FileBasedCache

LocMemCache

DummyCache

Настройка кэширования

Аргументы кэша

Настройка бэкенда кэша на примере Redis

  

Django поддерживает несколько типов бэкендов для работы с кэшем:

### PyMemcacheCache

**Принцип работы:** Использует библиотеку `pymemcache` для взаимодействия с Memcached. Memcached хранит данные в оперативной памяти и поддерживает простую структуру ключ-значение.

**Плюсы:**

- **Высокая скорость доступа:** Данные хранятся в оперативной памяти, что обеспечивает быстрый доступ.
- **Поддержка распределенного кэширования:** Можно настроить кластер из нескольких Memcached серверов для распределения нагрузки.

**Минусы:**

- **Данные теряются при перезапуске сервера:** Поскольку Memcached хранит данные в оперативной памяти, они не сохраняются при перезапуске.
- **Требуется отдельный сервер для Memcached:** Нужен отдельный сервер или кластер серверов для работы Memcached.

**Кому подходит:** Приложениям с высокими нагрузками и требованием быстрого доступа к данным, например, веб-приложениям с большим количеством пользователей.

### RedisCache

**Принцип работы:** Использует Redis для хранения данных в оперативной памяти. Redis поддерживает множество типов данных, включая строки, хэш-таблицы, списки, множества и т.д.

**Плюсы:**

- **Высокая производительность:** Как и Memcached, Redis хранит данные в оперативной памяти.
- **Расширенные возможности кэширования:** Поддерживает сложные структуры данных и операции.
- **Репликация и сохранение данных на диск:** Можно настроить репликацию данных и периодическое сохранение на диск для повышения надежности.

**Минусы:**

- **Требуется настройка и поддержка Redis сервера:** Нужен отдельный сервер или кластер серверов для работы Redis.

**Кому подходит:** Приложениям, которым нужны расширенные возможности кэширования и работа с различными структурами данных, например, системы реального времени, кэширование сессий и др.

### DatabaseCache

**Принцип работы:** Сохраняет кэшированные данные в базе данных, используя стандартный механизм хранения данных Django.

**Плюсы:**

- **Простота настройки:** Использует существующую базу данных.
- **Данные сохраняются при перезапуске сервера:** Данные хранятся в базе данных, что обеспечивает их сохранность.

**Минусы:**

- **Меньшая производительность:** Доступ к данным медленнее по сравнению с кэшированием в оперативной памяти.
- **Нагрузка на базу данных:** Увеличивает нагрузку на базу данных.

**Кому подходит:** Небольшим проектам или приложениям с уже настроенной быстрой базой данных.

### FileBasedCache

**Принцип работы:** Сохраняет кэшированные данные в виде файлов на диске.

**Плюсы:**

- **Простота настройки:** Не требует дополнительных сервисов.
- **Данные сохраняются при перезапуске сервера:** Файлы остаются на диске.

**Минусы:**

- **Меньшая производительность:** Доступ к файлам на диске медленнее, чем к данным в памяти.
- **Проблемы при большом количестве файлов:** Файловая система может испытывать затруднения при большом количестве мелких файлов.

**Кому подходит:** Небольшим приложениям или в разработке, когда необходим простой способ кэширования данных.

### LocMemCache

**Принцип работы:** Хранит кэшированные данные в локальной оперативной памяти сервера.

**Плюсы:**

- **Высокая скорость доступа:** Данные находятся в памяти, что обеспечивает быстрый доступ.
- **Простота настройки:** Не требует дополнительных сервисов или сложной конфигурации.

**Минусы:**

- **Данные теряются при перезапуске сервера:** Данные хранятся только в памяти.
- **Доступ только в пределах одного процесса:** Данные не доступны между разными процессами.

**Кому подходит:** Для разработки и тестирования, а также для небольших приложений на одном сервере.

### DummyCache

**Принцип работы:** Не сохраняет данные в кэш, а просто реализует интерфейс кэширования без фактического кэширования данных.

**Плюсы:**

- **Полностью отключает кэширование:** Полезно для отладки и тестирования.
- **Не требует настройки:** Прост в использовании.

**Минусы:**

- **Не подходит для использования в продакшене:** Не обеспечивает фактическое кэширование данных.

**Кому подходит:** Для разработки и тестирования, когда необходимо отключить кэширование, но сохранить совместимость кода.

### Настройка кэширования

Для того, чтобы подключить любой способ кэширования, нужно добавить константу `CACHES` в `settings.py`, со следующим содержимым:

```Python
CACHES = {
    "default": {
        "BACKEND": "cache_type",
        "LOCATION": "URL or IP",
    }
}
```

- **CACHES**: Это словарь, который содержит настройки для различных кэшей в вашем приложении.
- **default**: Это ключ в словаре `CACHES`, который определяет настройки по умолчанию для системы кэширования. Вы можете иметь несколько различных конфигураций кэшей, но `default` будет использоваться, если не указана другая конфигурация.
- **BACKEND**: Указывает тип используемого кэша. Это строка, которая определяет, какой бекенд будет использоваться для кэширования. Примеры значений:
    - `"django.core.cache.backends.memcached.MemcachedCache"` для Memcached,
    - `"django_redis.cache.RedisCache"` для Redis,
    - `"django.core.cache.backends.db.DatabaseCache"` для базы данных,
    - `"django.core.cache.backends.filebased.FileBasedCache"` для кэширования на файловой системе,
    - `"django.core.cache.backends.locmem.LocMemCache"` для локального кэширования в памяти.
- **LOCATION**: Указывает местоположение сервера или место хранения кэшированных данных. Это может быть URL, IP-адрес или путь к файлам. Примеры значений:
    - `"127.0.0.1:11211"` для локального Memcached сервера,
    - `"redis://127.0.0.1:6379/1"` для Redis сервера,
    - `"/var/tmp/django_cache"` для файлового кэша,
    - `"my_cache_table"` для кэширования в базе данных.

### Аргументы кэша

Также для всех бэкендов доступны следующие аргументы:

**TIMEOUT**: Время жизни кэшированных данных в секундах. По умолчанию — 300 секунд (5 минут). Значение `None` делает кэш бессрочным, а `0` — немедленным удалением (не кэширует).

**KEY_PREFIX**: Строка, добавляемая к каждому кэш-ключу для уникальности.

**VERSION**: Версия ключей кэша. Используется для управления изменениями в структуре данных.

**KEY_FUNCTION**: Функция, определяющая, как составляется финальный ключ кэша из префикса, версии и ключа.

**OPTIONS**: Дополнительные опции для бэкенда. Варианты зависят от используемого бэкенда и могут включать специфичные настройки.

Опции для бэкендов с собственной стратегией удаления старых данных (например, бэкенды locmem, файловой системы и базы данных):

- **MAX_ENTRIES**: Максимальное количество записей в кэше. По умолчанию — 300.
- **CULL_FREQUENCY**: Доля записей, удаляемых при достижении MAX_ENTRIES. Фактическое соотношение равно 1 / CULL_FREQUENCY. Значение `2` удаляет половину записей, `0` — очищает весь кэш. По умолчанию — 3.

### **Настройка бэкенда кэша на примере Redis**

```Python
CACHES = {
    "default": {
        "BACKEND": "django.core.cache.backends.redis.RedisCache",
        "LOCATION": "redis://127.0.0.1:6379",
        "OPTIONS": {
            "db": "10",
            "parser_class": "redis.connection.PythonParser",
            "pool_class": "redis.BlockingConnectionPool",
        },
    }
}
```

**Параметры внутри OPTIONS:**

- **db**: Номер базы данных, что позволяет разделять данные в пределах одного сервера Redis.
    
    Указывает, какую логическую базу данных Redis использовать. По умолчанию Redis поставляется с 16 базами данных (нумерованных от 0 до 15). В данном примере используется база данных номер 10.
    
- **parser_class**: Определяет, как данные будут парситься и интерпретироваться. Это может влиять на производительность.
    
    Указывает класс парсера для взаимодействия с Redis. В данном случае используется `"redis.connection.PythonParser"`. По умолчанию, если установлен пакет `hiredis-py`, будет использоваться `HiredisParser`.
    
- **pool_class**: Определяет, как будут управляться соединения с Redis, что может быть важно для масштабируемости и производительности.
    
    Указывает класс пула подключений для управления соединениями с Redis. В данном примере используется `"redis.BlockingConnectionPool"`. По умолчанию используется `redis.ConnectionPool`.

<div class="page-break" style="page-break-before: always;"></div>
