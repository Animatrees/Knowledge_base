Коды 301 и 302

Классы HttpResponseRedirect и HttpResponsePermanentRedirect

Функция redirect

Функция reverse

**Перенаправление (Redirect)** в контексте веб-разработки означает отправку клиента на другую страницу после того, как он сделал запрос к текущей странице. Это может быть полезно в различных сценариях, таких как перенаправление пользователя после успешной отправки формы, перенаправление с некорректного URL на правильный, или перенаправление пользователя после успешной аутентификации.

### Коды 301 и 302

1. **301 Moved Permanently (Перемещено навсегда)**:
    - Код состояния HTTP 301 указывает, что запрошенный ресурс был окончательно перемещен на новый URL.
    - Это означает, что поисковые системы и клиенты должны использовать новый URL в будущем, так как старый URL больше не будет актуален.
    - При получении ответа с кодом 301, браузеры обычно автоматически обновляют закладки и кэш, чтобы использовать новый URL вместо старого.
2. **302 Found (Найдено)**:
    - Код состояния HTTP 302 указывает, что запрошенный ресурс временно находится по другому URL.
    - Это означает, что клиенты должны использовать временный URL для доступа к ресурсу, но в будущем может измениться.
    - При получении ответа с кодом 302, браузеры обычно запоминают временный URL только для текущей сессии и не обновляют закладки или кэш.

### Классы HttpResponseRedirect и HttpResponsePermanentRedirect

`**HttpResponseRedirect**` и `**HttpResponsePermanentRedirect**` - это два класса-наследника от класса `**HttpResponse**`. Они используются в Django для выполнения HTTP-перенаправлений.

1. **HttpResponseRedirect**:
    - Этот класс используется для временного перенаправления (код состояния HTTP 302).
    - Для создания объекта этого класса должен быть передан один обязательный аргумент `**redirect_to**`. Этот аргумент должен быть строкой, содержащей URL, на который будет выполнено перенаправление. URL адрес будет сохранён в атрибут объекта **`Location`**.
    - При отправке этого ответа браузер клиента будет автоматически переходить на указанный URL.
    - Пример использования:
        
        ```Python
        from django.http import HttpResponseRedirect
        
        redirect = HttpResponseRedirect('/new_page/')
        ```
        
2. **HttpResponsePermanentRedirect**:
    - Этот класс используется для постоянного перенаправления (код состояния HTTP 301).
    - Создаётся аналогично объекту **`HttpResponseRedirect`** передачей обязательного аргумента - URL в формате строки, который сохраняется в атрибут **`Location`**.
    - Пример использования:
        
        ```Python
        from django.http import HttpResponsePermanentRedirect
        
        permanent_redirect = HttpResponsePermanentRedirect('/new_page/')
        ```
        

> [!important]  
> В приведенных выше примерах URL-адреса перенаправления жестко закодированы. Хардкодинг URL-адресов - плохая практика: если URL-адрес когда-либо изменится, вам придется выполнить поиск по всему коду и изменить все вхождения.  

### Функция redirect

Функция `**redirect()**` в Django используется для выполнения перенаправления пользователя на другую страницу.  
Она самостоятельно вызывает определённые методы и функции, чтобы преобразовать аргументы в URL и вернуть экземпляр  
**`HttpResponseRedirect`** (по умолчанию) или `**HttpResponsePermanentRedirect**`, если будет задан аргумент **`permanent=True`**. Импортируется из модуля - `**django.shortcuts**`

1. **Синтаксис**:
    
    ```Python
    from django.shortcuts import redirect
    
    def view(request):
    	return redirect(to, *args, permanent=False, **kwargs)
    ```
    
2. **Параметры**:
    - Параметр `**to**` является обязательным и принимает различные типы аргументов, позволяющие задать путь для перенаправления:
        - Здесь может быть указан URL-адрес (как абсолютный, так и относительный). Например,
            
            ```Python
            from django.shortcuts import redirect
            
            #Абсолютный URL
            def view(request):
            	return redirect('https://example.com/new_page/')
            
            #Абсолютный URL внутри текущего домена.
            def view2(request):
            	return redirect('/path/to/redirect/')
            
            #Относительный URL внутри текущего домена.
            def view2(request):
            	return redirect('add/this/')
            ```
            
            **Важно!**
            
            1. _Абсолютный URL внутри текущего домена:_
                - _В этом случае URL-адрес начинается с_ _`/`__, что указывает на корень текущего домена. Django будет выполнять перенаправление на конкретную страницу внутри текущего домена._
                - _Например,_ _`redirect('/path/to/redirect/')`_ _отправит пользователя на страницу с URL_ _`https://example.com/path/to/redirect/`__._
            2. _Относительный URL внутри текущего домена:_
                - _Здесь URL-адрес не начинается с_ _`/`_ _и представляет собой относительный путь относительно текущей страницы._
                - _Например,_ _`redirect('add/this/')`_ _отправит пользователя на страницу с URL, построенным относительно текущего URL, например, если текущий URL_ _`https://example.com/somepage/`__, то пользователь будет перенаправлен на_ _`https://example.com/somepage/add/this/`__._
        - Также здесь может быть указано имя [[b-j. Динамические URL и конвертеры]]маршрута. Например:
            
            ```Python
            from django.shortcuts import redirect
            
            # без аргументов
            # перенаправление на адрес домашней страницы http://127.0.0.1:8000/
            def view(request):
            	return redirect('home')
            
            # c позиционными аргументами
            # перенаправление на адрес: http://127.0.0.1:8000/archive/2022/10/
            def view2(request):
            	return redirect('archive', '2022', '10')
            
            # с именовами аргументами
            # перенаправление на адрес: http://127.0.0.1:8000/archive/2022/10/
            def view2(request):
            	return redirect('archive', month='10', year='2022')
            ```
            
            В данном случае генерация url маршрута происходит путём вызова функций `resolve_url` и `reverse` внутри Django.
            
        - В качестве пути может быть указано и название представления, вызов которого будет использован для перенаправления. При чём аргументы для этого представления могут быть переданы позиционными или именованными параметрами в функцию redirect. Например:
            
            ```Python
            def posts(request, month, year):
                if year < 2022:
                    return redirect(archive, year, month)
                return HttpResponse(f'Посты за {month} месяц и {year} год')
            ```
            
            Этот способ также отрабатывает за счёт вызова `resolve_url` и `reverse`.
            
        - Экземпляр модели или любой другой объект с поддержкой метода **`get_absolute_url()`** _*мы ещё не проходили модели, поэтому этот пункт я пока оставлю без более подробного описания._
    - **args и kwargs** (необязательные):
        - Позиционные или именованные аргументы, которые будут переданы в конструктор URL, если параметр `**to**` является именем маршрута или названием представления.

Пример использования:

```Python
from django.shortcuts import redirect

def my_view(request):
    # Проверяем, авторизован ли пользователь
    if not request.user.is_authenticated:
        # Если не авторизован, перенаправляем на страницу входа
        return redirect('/accounts/login/')
    else:
        # Если авторизован, отображаем нужную страницу
        return render(request, 'my_template.html', context)
```

В этом примере, если пользователь не авторизован, функция `**my_view()**` выполнит перенаправление на страницу входа. Если пользователь авторизован, будет отображена страница `**my_template.html**`.

### Функция reverse

Функция `**reverse()**` используется для генерации URL-адреса на основе имени маршрута или названия представления. Она возвращает строку, представляющую сгенерированный URL-адрес. Импортируется из модуля **`django.urls`**

**Синтаксис:**

```Python
from django.urls import reverse

reverse(viewname, urlconf=None, args=None, kwargs=None, current_app=None)
```

**Параметры:**

- `**viewname**`: Обязательный аргумент. Это может быть имя маршрута URL или название представления.
- `**urlconf**`: Необязательный аргумент. Определяет, какую конфигурацию URL использовать при разрешении имени маршрута. По умолчанию используется конфигурация, определенная для текущего проекта.
- `**args**`: Необязательный аргумент, кортеж или список позиционных аргументов, которые будут переданы в конструктор URL, если маршрут содержит параметры.
- `**kwargs**`: Необязательный аргумент, словарь именованных аргументов, которые будут переданы в конструктор URL.> [!important]  
    > args и kwargs не могут быть переданы в reverse() одновременно.  
    
- `**current_app**`: Необязательный аргумент, строка, представляющая имя текущего приложения. Он используется, когда имена маршрутов конфликтуют между несколькими приложениями.

Пример использования:

```Python
from django.urls import reverse


def my_view(request):
    # ...

url = reverse('my_view')
print(url)
#вывод /my-view/
```

<div class="page-break" style="page-break-before: always;"></div>
