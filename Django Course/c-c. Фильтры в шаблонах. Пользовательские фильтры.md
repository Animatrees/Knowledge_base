Синтаксис

Встроенные фильтры

Создание пользовательских фильтров

Использование фильтров в качестве функций в коде

Фильтры в шаблонах Django представляют собой специальные функции, используемые для форматирования данных перед выводом их в шаблоне.Используются для выполнения различных операций над переменными в шаблоне, таких как форматирование строк, изменение регистра, обрезка текста и другие.

### **Синтаксис**

- Фильтры применяются к переменным в шаблоне с помощью символа `**|**` (pipe), за которым следует название фильтра и его аргументы, если таковые имеются.  
    Аргументы для фильтров передаются напрямую после имени фильтра, разделённые двоеточием, без пробела!  
    
- Пример: `**{{ variable|filter:arg }}**`

**Цепочки фильтров:**

- Можно применять несколько фильтров последовательно, образуя цепочку.
- Например: `**{{ variable|filter1|filter2 }}**`

### **Встроенные фильтры**

- Django предоставляет ряд встроенных фильтров для решения общих задач форматирования данных.
    
    > [!info] Django  
    > The web framework for perfectionists with deadlines.  
    > [https://docs.djangoproject.com/en/4.2/ref/templates/builtins/#ref-templates-builtins-filters](https://docs.djangoproject.com/en/4.2/ref/templates/builtins/#ref-templates-builtins-filters)  
    
- Фильтры из лекции (описание из документации):
    - `add`
        
        Добавляет аргумент к значению.
        
        **Пример:**
        
        `{{ value|add:"2" }}`
        
        Если значение равно 4, то результат будет 6.
        
        Этот фильтр сначала попытается преобразовать оба значения в целые числа. Если это не удастся, он все равно попытается сложить значения. Это сработает для некоторых типов данных (строки, список и т.д.) и завершится неудачей для других. Если это не удастся, результатом будет пустая строка.
        
        **Пример:**
        
        `{{ first|add:second }}`
        
        Если `first` - [1, 2, 3], а `second` - [4, 5, 6], то результатом будет [1, 2, 3, 4, 5, 6].
        
        > [!important]  
        > Строки, которые можно преобразовать в целые числа, будут суммироваться, а не конкатенироваться, как в первом примере выше.  
        
    - `capfirst`
        
        Преобразует первый символ значения в верхний регистр. Если первый символ не является буквой, этот фильтр не будет иметь никакого эффекта.
        
        **Пример:**
        
        `{{ value|capfirst }}`
        
        Если значение равно "django", то результат будет "Django".
        
    - `lower`
        
        Преобразует строку в нижний регистр.
        
        **Пример:**
        
        `{{ value|lower }}`
        
        Если значение равно "Joel is a slug", то результат будет "joel is a slug".
        
    - `upper`
        
        Преобразует строку в верхний регистр.
        
        **Пример:**
        
        `{{ value|upper }}`
        
        Если значение равно "Joel is a slug", то результат будет "JOEL IS A SLUG".
        
    - `cut`
        
        Удаляет все значения аргумента из заданной строки.
        
        **Пример:**
        
        `{{ value|cut:" " }}`
        
        Если значение равно "Строка с пробелами", то результат будет "Строкаспробелами".
        
    - `first`
        
        Возвращает первый элемент списка.
        
        **Пример:**
        
        `{{ value|first }}`
        
        Если значение равно списку `['a', 'b', 'c']`, то результат будет `'a'`.
        
    - `last`
        
        Возвращает последний элемент списка.
        
        **Пример:**
        
        `{{ value|last }}`
        
        Если значение равно списку `['a', 'b', 'c']`, то результат будет `'c'`.
        
    - `length`
        
        Возвращает длину значения. Работает как для строк, так и для списков.
        
        **Пример:**
        
        `{{ value|length }}`
        
        Если значение равно `"abcd"` или списку `['a', 'b', 'c', 'd']`, то результат будет `4`.
        
        Фильтр возвращает 0 для неопределенной переменной.
        
    - `default`
        
        Используется для определения значения по умолчанию, которое будет возвращено, если значение выражения равно `False` или если переменная не определена в context.
        
        **Пример:**
        
        `{{ value|default:"nothing" }}`
        
        Если значение равно `"abc"` (не `False`), то результат будет `"abc"`. Если же значение равно `False`, то результат будет `"nothing"`.
        
    - `divisibleby`
        
        Проверяет, делится ли значение на заданное число.
        
        **Пример:**
        
        `{{ value|divisibleby:3 }}`
        
        Если значение равно `21`, то результат будет `True`.
        
    - `join`
        
        Соединяет элементы списка в строку, аналогично методу Python str.join(list).
        
        **Пример:**
        
        `{{ value|join:" // " }}`
        
        Если `value` – это список ['a', 'b', 'c'], результатом будет строка "a // b // c”
        
    - `slugify`
        
        Преобразует в ASCII. Преобразует пробелы в дефисы. Удаляет символы, которые не являются буквенно-цифровыми, подчеркиваниями или дефисами. Преобразует в нижний регистр. Также удаляет начальные и конечные пробелы.
        
        **Пример**
        
        `{{ value|slugify }}`
        
        Если значение `value` - "Joel is a slug", то результат будет "joel-is-a-slug".
        
        > [!important]  
        > Slugify не предназначена для работы с символами, отличными от ASCII. Поэтому русские символы не обрабатываются должным образом и могут быть просто удалены или заменены на пустые строки, что в результате может привести к нежелательным или непредсказуемым результатам.  
        

### Создание пользовательских фильтров

В Django можно определять собственные пользовательские фильтры для выполнения специфических операций над данными.

1. **Создание папки** `**templatetags**`**:**
    - Приложение должно содержать каталог `templatetags` на том же уровне, что и `models.py`, `views.py` и т.д. Если он еще не существует, создайте его - не забудьте про файл `__init__.py`, чтобы каталог воспринимался как пакет Python.
2. **Создание Python-модуля:**
    
    - В папке `templatetags` создайте файл с расширением `.py` (например, `custom_filters.py`).
    
    ![[Untitled 6 1.png|Untitled 6 1.png]]
    
    > [!important]  
    > Сервер не перезапускается автоматически!После добавления модуля templatetags вам нужно перезапустить сервер, прежде чем вы сможете использовать теги или фильтры в шаблонах.  
    
3. **Определение фильтра:**
    
    - В файле `custom_filters` определите функцию или несколько функций, которые будут являться вашими фильтрами.
    - Импортируйте модуль `template` из Django.
    - Создайте экземпляр класса `template.Library()`.
    - Зарегистрируйте ваш фильтр с помощью декоратора `**register.filter**`
    
    ```Python
    from django import template
    
    register = template.Library()
    
    # можно задать имя с помощью аргумента name
    @register.filter(name='db2')
    def divide_by_2(value):
        try:
            return int(value) // 2
        except ValueError:
            return 0
    
    # или не указывать имя, тогда по умолчанию будет использовано имя функции
    @register.filter
    def add_string(value, arg):
        return value + arg
    ```
    
4. **Использование в шаблонах:**
    
    - В вашем шаблоне импортируйте фильтры с помощью `{% load custom_filters %}`, где `custom_filters` - это имя файла без расширения.
    - Затем используйте ваш фильтр в шаблоне, например:
    
    ```HTML
    ...
    {% load custom_filters %}
    <h1>{{ title }}</h1>
    <p>{{ number|db2 }}</p>
    <p>{{ test|add_string:' for you' }}</p>
    ...
    ```
    
    ![[Untitled 1 4.png|Untitled 1 4.png]]
    
    ![[Untitled 2 3.png|Untitled 2 3.png]]
    

### Использование фильтров в качестве функций в коде

В некоторых случаях, возможно использовать фильтры в качестве функций в Python-коде, но это не является общепринятой практикой и может считаться неудачным дизайном. Вместо этого, лучше создавать функции, которые делают необходимые операции, и вызывать их там, где это необходимо.

Пример того, как можно использовать фильтры в качестве функций в Python:

```Python
from django.template.defaultfilters import slugify

def custom_function(value):
    # Используем фильтр slugify
    return slugify(value)

# Пример использования
result = custom_function("Some random text")
print(result)  # Выведет: "some-random-text"
```

Хотя это может работать, это не рекомендуется, так как это нарушает принципы разделения ответственности и ухудшает читаемость кода.

<div class="page-break" style="page-break-before: always;"></div>
