SMTP бэкенд (по умолчанию)

Console бэкенд

File бэкенд

In-memory бэкенд

Dummy бэкенд

send_mail()

Почтовые бэкенды в Django - это механизмы, которые позволяют отправлять email-сообщения из приложения. Django предоставляет несколько встроенных бэкендов для отправки email, а также позволяет создавать свои собственные бэкенды, если есть специфические требования.

Далее описаны основные почтовые бэкенды Django.

### SMTP бэкенд (по умолчанию)

- Это стандартный бэкенд, который используется по умолчанию в Django.
- Email отправляется через SMTP сервер, указанный в настройках Django.
- Для настройки SMTP бэкенда необходимо указать следующие параметры в файле настроек:
    - `EMAIL_HOST`: адрес SMTP сервера
    - `EMAIL_PORT`: порт SMTP сервера
    - `EMAIL_HOST_USER`: имя пользователя для аутентификации на SMTP сервере
    - `EMAIL_HOST_PASSWORD`: пароль для аутентификации на SMTP сервере
    - `EMAIL_USE_TLS`: использовать ли TLS шифрование при подключении к SMTP серверу
    - `EMAIL_USE_SSL`: использовать ли SSL шифрование при подключении к SMTP серверу
    - `EMAIL_TIMEOUT`: таймаут для соединения с SMTP сервером
    - `EMAIL_SSL_KEYFILE` и `EMAIL_SSL_CERTFILE`: пути к файлам ключа и сертификата SSL, если используется SSL шифрование
- Этот бэкенд является предпочтительным для реального использования в production среде.

### Console бэкенд

- Вместо реальной отправки email, этот бэкенд просто выводит содержимое email в консоль (стандартный вывод).
- Полезен для отладки и разработки, чтобы видеть содержимое отправляемых email без фактической отправки.
- Для использования Console бэкенда нужно указать следующее в настройках:
    
    ```Python
    EMAIL_BACKEND = "django.core.mail.backends.console.EmailBackend"
    ```
    

### File бэкенд

- Этот бэкенд записывает email в файлы вместо отправки.
- Каждая новая сессия создает новый файл для записи email.
- Путь к директории, где будут сохраняться файлы, указывается в настройке `EMAIL_FILE_PATH` или передается как аргумент `file_path` при создании соединения.
- Для использования File бэкенда нужно указать следующее в настройках:
    
    ```Python
    EMAIL_BACKEND = "django.core.mail.backends.filebased.EmailBackend"
    EMAIL_FILE_PATH = "/tmp/app-messages"
    ```
    

### In-memory бэкенд

- Этот бэкенд сохраняет email в специальном атрибуте модуля `django.core.mail`.
- Атрибут `outbox` создается при отправке первого сообщения и содержит список экземпляров `EmailMessage` для каждого отправляемого email.
- Полезен для тестирования и разработки, позволяет проверять содержимое отправляемых email без фактической отправки.
- Для использования In-memory бэкенда нужно указать следующее в настройках:
    
    ```Python
    EMAIL_BACKEND = "django.core.mail.backends.locmem.EmailBackend"
    ```
    
    > [!important]  
    > Программа тестирования Django автоматически использует этот бэкенд для тестирования.  
    

### Dummy бэкенд

- Этот бэкенд ничего не делает с отправляемыми email, просто игнорирует их))
- Полезен в случаях, когда нужно отключить реальную отправку email, например, во время разработки или тестирования.
- Для использования Dummy бэкенда нужно указать следующее в настройках:
    
    ```Python
    EMAIL_BACKEND = "django.core.mail.backends.dummy.EmailBackend"
    ```
    

При разработке Django приложения, выбор подходящего почтового бэкенда зависит от конкретных требований и среды разработки. Для локальной разработки и тестирования часто используются Console, File или In-memory бэкенды, которые позволяют проверять содержимое email без фактической отправки. Для реального использования в production среде рекомендуется использовать SMTP бэкенд с настроенным SMTP сервером.

Кроме того, Django позволяет создавать свои собственные почтовые бэкенды, если есть специфические требования к отправке email. Для этого нужно создать класс, наследующийся от `django.core.mail.backends.base.BaseEmailBackend`, и реализовать необходимые методы, такие как `send_messages()`.

### send_mail()

Функция `send_mail()` является удобным способом отправки email сообщений в Django. Она предоставляет простой интерфейс для отправки email без необходимости явного создания экземпляров `EmailMessage` или `EmailMultiAlternatives`.

**Синтаксис:**

```Python
send_mail(subject, message, from_email, recipient_list, fail_silently=False, auth_user=None, auth_password=None, connection=None, html_message=None)
```

**Параметры:**

- `subject` (str): Тема email сообщения.
- `message` (str): Текстовое содержимое email сообщения.
- `from_email` (str): Email адрес отправителя.
- `recipient_list` (list): Список email адресов получателей.
- `fail_silently` (bool, optional): Если установлено в `True`, любые возникающие исключения при отправке email будут игнорироваться. По умолчанию `False`.
- `auth_user` (str, optional): Имя пользователя для аутентификации на SMTP сервере. Если не указано, используется значение настройки `EMAIL_HOST_USER`.
- `auth_password` (str, optional): Пароль для аутентификации на SMTP сервере. Если не указано, используется значение настройки `EMAIL_HOST_PASSWORD`.
- `connection` (EmailBackend, optional): Экземпляр почтового бэкенда для отправки email. Если не указано, создается новое соединение на основе настроек почтового бэкенда.
- `html_message` (str, optional): HTML версия содержимого email сообщения. Если указано, email будет отправлен как многочастное сообщение (multipart) с текстовой и HTML версиями.

**Возвращаемое значение:**

- Количество успешно отправленных сообщений. Может быть 0 или 1. Возвращаемое значение функции `send_mail()` не зависит от количества получателей. Оно указывает только на **успешность отправки самого сообщения**, а не на количество получателей, которым оно было отправлено.

**Пример использования:**

```Python
from django.core.mail import send_mail

subject = 'Тема сообщения'
message = 'Текстовое содержимое сообщения'
from_email = 'from@example.com'
recipient_list = ['to1@example.com', 'to2@example.com']

send_mail(subject, message, from_email, recipient_list)
```

Функция `send_mail()` использует настройки почтового бэкенда, указанные в файле настроек Django (`settings.py`), такие как `EMAIL_HOST`, `EMAIL_PORT`, `EMAIL_HOST_USER`, `EMAIL_HOST_PASSWORD` и другие, для отправки email через соответствующий почтовый сервер.

<div class="page-break" style="page-break-before: always;"></div>
