Статические файлы

Хранение статических файлов и settings.py

Флаг --insecure в команде python manage.py runserver

Приложение django.contrib.staticfiles

Тег load

Тег static

### Статические файлы

**Статические файлы** - это файлы, которые не меняются динамически при запросе пользователя. К ним относятся:

- Изображения (`.jpg`, `.png`, `.gif` и т.д.)
- Файлы стилей CSS
- JavaScript-скрипты
- Шрифты
- Видео
- Любые другие неизменяемые файлы, необходимые для работы веб-приложения

**Статические файлы используются для:**

1. **Визуального оформления**: CSS-стили и изображения используются для стилизации и оформления веб-страниц, делая их более привлекательными и понятными для пользователя.
2. **Интерактивности**: JavaScript-скрипты добавляют интерактивность и динамическое поведение на веб-страницах, такие как анимации, проверка форм, AJAX-запросы и т.д.
3. **Хранения статических данных**: Файлы JSON, XML и другие используются для хранения статических данных, таких как конфигурационные файлы, локализованные строки, информация о продукте и т.д.

**Статические файлы отделяются от динамического кода Django по нескольким причинам:**

- **Производительность:** Статические файлы могут быть кешированы браузером пользователя, что ускоряет загрузку страницы.
- **Масштабируемость:** Статические файлы могут обслуживаться с отдельного сервера, что позволяет масштабировать приложение.
- **Разделение ответственности:** Разделение статических и динамических файлов упрощает разработку и сопровождение приложения.

### Хранение статических файлов и `settings.py`

> [!important]  
> Для того, чтобы все способы хранения работали корректно, в INSTALLED_APPS обязательно должно быть добавлено приложение 'django.contrib.staticfiles’. Ниже [[c-g. Подключение статических файлов]] описание этого приложения.  

1. **В директориях приложений:**
    
    Это рекомендуемый способ хранения статических файлов во время разработки сайта.
    
    - **Настройка**:
        
        Создаём директорию `static` внутри каждого приложения, внутри неё создаём директорию с названием, аналогичным названию приложения (чтобы избежать коллизии имён, как у шаблонов). Внутри можно создать дополнительные поддиректории, например, `css`, `js`, `images` и другие, чтобы разделить файлы по типам для более удобного взаимодействия.
        
        ![[Untitled 7 1.png|Untitled 7 1.png]]
        
        Настройка `STATIC_URL = 'static/’` в файле `settings.py` в данном случае отвечает за автоматическое добавление префикса `'static/’` ко всем путям, то есть мы можем указывать путь до статического файла начиная с поддиректории приложения, игнорируя начало, например - `'basefunc/css/styles.css’`
        
    - **Использование в продакшене**: Не рекомендуется для продакшена из-за неудобства в управлении статическими файлами.
2. **По нестандартному пути:**
    
    Также статические файлы могут храниться по нестандартному пути, например, в случае, когда несколько приложений используют одни и те же статические файлы. Как и предыдущий способ хранения, используется только на время разработки сайта.
    
    - **Настройка**:
        
        Нужно указать путь к директории со статическими файлами с помощью переменной `STATICFILES_DIRS` в файле `settings.py`.
        
    - **Использование в продакшене**: Не рекомендуется, так как не позволяет оптимизировать загрузку файлов.
3. **В папке static, общей для всего проекта:**
    
    Данный способ хранения используется во время продакшена, так как позволяет оптимизировать загрузку файлов или вовсе хранить их на другом сервере (не том, который обслуживает основной сайт).
    
    - **Настройка**:
        
        Указывается путь к общей директории для собранных статических файлов с помощью переменной `STATIC_ROOT` в файле `settings.py`.
        
        Во время развертывания приложения необходимо выполнить команду `python manage.py collectstatic`, чтобы собрать все статические файлы из приложений в директорию `STATIC_ROOT`, которая будет обслуживаться веб-сервером.
        
    - **Использование во время разработки**: Не рекомендуется, так как при каждом изменении файлов необходимо вручную запускать `collectstatic`.

### **Флаг --insecure в команде** `**python manage.py runserver**`

- В режиме разработки Django, когда вы запускаете сервер с помощью `python manage.py runserver`, встроенный веб-сервер автоматически обслуживает статические файлы, такие как CSS, JavaScript, изображения, и т. д.
    
    Django по умолчанию не разрешает доступ к статическим файлам в режиме продакшена (если `DEBUG` установлен в `False`).
    
- Флаг `-insecure` отключает эту функциональность и предоставляет возможность увидеть, как ваше приложение может вести себя в более близком к продакшену окружении, где статические файлы обычно обслуживаются веб-сервером, а не Django.

> [!important]  
> Использование этого флага в производственной среде крайне не рекомендуется, так как это может снизить производительность и безопасность приложения.  

### **Приложение** `**django.contrib.staticfiles**`

1. **Назначение:**
    - Предоставляет инструменты для управления статическими файлами в проекте Django.
    - Упрощает сборку и обслуживание статических файлов во время разработки и развертывания.
2. **Включение:**
    - `django.contrib.staticfiles` является встроенным приложением Django.
    - Для его активации необходимо добавить его в `INSTALLED_APPS` в файле `settings.py`.
3. **Основные функции:**
    - **Управление статическими файлами в процессе разработки:**
        - Автоматическое обслуживание статических файлов из папок `static` внутри каждого приложения.
        - Поддержка поиска статических файлов в папках `static` во всех установленных приложениях.
        - Использование тега шаблона `static` для вставки URL-адресов статических файлов в шаблоны.
    - **Сборка статических файлов в процессе развертывания:**
        - Команда `python manage.py collectstatic` собирает все статические файлы из всех установленных приложений в одну общую директорию.
        - Позволяет упростить управление статическими файлами и повысить производительность веб-сервера в продакшене.

### Тег load

Тег `{% load %}` используется для загрузки тегов или фильтров из различных библиотек шаблонов Django (в том числе пользовательских).

В контексте работы со статическими файлами, тег `{% load %}` часто используется для загрузки тега `static` для удобного доступа к статическим файлам в шаблонах.

**Синтаксис:**

- Общий формат использования тега `{% load %}`:
    
    ```Python
    {% load имя_тега_или_фильтра %}
    ```
    
- Для загрузки тега `static`, который используется для создания URL-адресов статических файлов, синтаксис выглядит следующим образом:
    
    ```Python
    {% load static %}
    ```
    

### Тег static

Тег `{% static %}` обеспечивает генерацию правильных URL-адресов для доступа к статическим файлам.

**Синтаксис:**

```Python
{% static 'путь_к_статическому_файлу' %}
```

В качестве аргумента тега указывается путь к статическому файлу относительно директории, в которой хранятся статические файлы приложения или общей директории для собранных статических файлов (зависит от конфигурации проекта).

**Пример использования для создания URL-адреса к статическому файлу** `**style.css**`**:**

```HTML
<link type="text/css" href="{% static 'basefunc/css/styles.css' %}" rel="stylesheet" />
```

- В этом примере генерирует URL-адрес для файла `style.css`, используя значение переменной `STATIC_URL` из настроек проекта.

<div class="page-break" style="page-break-before: always;"></div>
