DPKG (Debian Package)

Где хранится и как используется база данных DPKG

Основные команды для работы с базой данных DPKG

Недостатки DPKG

APT (Advanced Package Tool)

Сравнение DPKG и APT

Как добавить новый репозиторий в APT

Основные команды для работы с APT

### **DPKG (Debian Package)**

- **Используется в:** Debian, Ubuntu и их производных дистрибутивах.
- **Описание:** DPKG - это система управления пакетами для Debian и его производных дистрибутивов. DPKG отвечает за установку, удаление и обновление пакетов. Он использует формат DEB (Debian Binary Package) для представления пакетов.

### Где хранится и как используется база данных DPKG

База данных DPKG, содержащая информацию об установленных пакетах и их состоянии, хранится в системе в файлах, находящихся в директории `**/var/lib/dpkg**`. Основные файлы базы данных включают:

1. **status:** Файл `**/var/lib/dpkg/status**` содержит информацию о текущем состоянии всех установленных пакетов. В нем хранятся данные о версиях пакетов, их статусе (установлен, удален, не настроен и т.д.), зависимостях и другие связанные атрибуты.
2. **available:** Файл `**/var/lib/dpkg/available**` содержит информацию о доступных (не установленных) пакетах. Этот файл используется для отображения подробной информации о пакетах, доступных для установки.
3. **info:** В директории `**/var/lib/dpkg/info**` содержатся поддиректории, каждая из которых соответствует установленному пакету и содержит информацию о файловой структуре пакета, сценариях установки и деинсталляции, а также другие сведения.

Dpkg использует эту базу данных для отслеживания состояния установленных пакетов, и она является ключевой частью системы управления пакетами Debian. Когда используются команды типа `**dpkg -i**` для установки пакетов, информация обновляется в этой базе данных.

### Основные команды для работы с базой данных DPKG

1. `**dpkg -i package_name**`: используется для установки (или обновления) указанного пакета.
2. `**dpkg -r package_name**`: удаляет указанный пакет, но оставляет его конфигурационные файлы.
3. `**dpkg -l**`: выводит подробный список всех установленных пакетов (или указанного пакета, если он указан) с различной информацией, такой как статус установки, версия пакета, описание и другие атрибуты.
4. `**dpkg -s package_name**`: выводит краткую информацию о статусе установки указанного пакета.
5. `**dpkg -V package_name**`: проверяет целостность файлов, принадлежащих установленному пакету.

Дополнительные команды:

- `**dpkg -L package_name**`: выводит список файлов, установленных данным пакетом.
- `**dpkg -S file_path**`: находит пакет, которому принадлежит указанный файл.
- `**dpkg-reconfigure package_name**`: используется для повторной настройки конфигурации указанного пакета.

### Недостатки DPKG

1. **Отсутствие управления зависимостями в реальном времени:**
    - DPKG не решает автоматически проблемы зависимостей в реальном времени во время установки или удаления пакетов. Это оставляет ответственность за разрешение зависимостей на пользователя.
2. **Отсутствие автоматического обновления репозиториев:**
    - Пользователю приходится вручную обновлять список доступных пакетов из репозиториев. Современные системы управления пакетами, такие как APT, которые построены поверх DPKG, решают эту проблему.
3. **Отсутствие обратной совместимости:**
    - DPKG не всегда обеспечивает обратную совместимость между различными версиями. Это может сделать обновление или откат версий сложным процессом.
4. **Проблемы с удалением конфигурационных файлов:**
    - При удалении пакета через DPKG, конфигурационные файлы остаются на месте. Чтобы удалить их, необходимо использовать опцию `**-purge**`. Это может привести к накоплению неиспользуемых конфигурационных файлов.
5. **Отсутствие средств для автоматизации обновлений:**
    - DPKG не предоставляет механизмов автоматического обновления системы, таких как возможности обновления всех установленных пакетов. В этом плане современные инструменты, построенные поверх DPKG, добавляют удобства.
6. **Отсутствие поддержки для резервного копирования/восстановления:**
    - DPKG не предоставляет встроенных механизмов для резервного копирования конфигурационных файлов перед их обновлением. Это может потребовать дополнительных усилий со стороны пользователя.

---

### **APT (Advanced Package Tool)**

Это высокоуровневый интерфейс для DPKG, предоставляющий более удобные команды для управления пакетами. APT также управляет зависимостями и обеспечивает возможность добавления репозиториев.

### Сравнение DPKG и APT

1. **Работа с зависимостями:**
    - **DPKG:** Низкоуровневый инструмент. При установке или обновлении пакета не удовлетворяет его зависимости автоматически, что может привести к сложностям.
    - **APT:** Высокоуровневый фронтэнд для DPKG. APT автоматически разрешает зависимости, обеспечивая установку или обновление всех необходимых пакетов, включая их зависимости.
2. **Обновление системы:**
    - **DPKG:** Сам по себе не предоставляет механизмов для обновления всей системы. Это может потребовать использования других инструментов, таких как `**apt**`.
    - **APT:** Предоставляет удобные команды для обновления всей системы и ее компонентов, таких как `**apt upgrade**` и `**apt dist-upgrade**`.
3. **Управление конфигурацией:**
    - **DPKG:** Не предоставляет автоматических средств управления конфигурационными файлами при обновлении пакетов.
    - **APT:** Обеспечивает механизмы управления конфигурационными файлами, позволяя сохранять текущие версии, сравнивать их и принимать решение о замене или сохранении.

### Как добавить новый репозиторий в APT

Добавление репозиториев в APT можно выполнить двумя основными способами: с использованием команды `**apt edit-sources**` и редактированием файла `**sources.list**` вручную.

**1.** Команда `**apt edit-sources**` предоставляет интерактивный способ добавления и редактирования репозиториев в системе.

- Запустите команду в терминале:
    
    ```Shell
    sudo apt edit-sources
    ```
    
- Это откроет текстовый редактор (например, nano) с текущими репозиториями. Вставьте новый репозиторий в соответствующее место.
- Сохраните изменения и закройте редактор.

2. Редактирование файла **`sources.list`**

- Откройте файл `**sources.list**` в текстовом редакторе. Обычно файл располагается по пути `**/etc/apt/sources.list**`.
    
    ```Shell
    sudo nano /etc/apt/sources.list
    ```
    
- Добавьте новый репозиторий в конец файла. Пример строки репозитория:
    
    ```Shell
    deb http://example.com/debian distribution main
    ```
    
    Где `**http://example.com/debian**` - URL репозитория, `**distribution**` - версия дистрибутива, `**main**` - основной компонент.
    
- Сохраните изменения и закройте редактор.

После внесения изменений в репозитории, необходимо выполнить команду `**sudo apt update**`, чтобы обновить информацию о доступных пакетах из добавленных репозиториев.

### Основные команды для работы с APT

1. `**apt update**`**-** обновляет локальную базу данных о пакетах из репозиториев. Это не устанавливает новые версии пакетов, но обновляет информацию о доступных версиях.
2. `**apt upgrade**`- обновляет все установленные пакеты до их последних версий. Команда автоматически разрешает зависимости и обеспечивает безопасное обновление системы.
3. `**apt install**`- устанавливает новые пакеты. Можно указать один или несколько пакетов для установки. APT автоматически разрешает зависимости и устанавливает все необходимые компоненты.
4. `**apt remove**`- удаляет установленные пакеты из системы. Эта команда также автоматически разрешает зависимости и удаляет связанные компоненты.
5. `**apt search**`- позволяет искать пакеты по ключевым словам. Команда выводит список пакетов, содержащих указанные ключевые слова в их описаниях.
6. `**apt list**`- показывает список всех установленных пакетов или всех доступных пакетов, в зависимости от использованных параметров.

Дополнительные полезные команды:

1. `**apt show**`- выводит подробную информацию о конкретном пакете, включая его описание, зависимости, версии и т.д.
2. `**apt autoremove**`- удаляет устаревшие и неиспользуемые пакеты, которые были установлены как зависимости, но больше не нужны.
3. `**apt clean**`- удаляет все загруженные архивы пакетов из кеша, освобождая место на диске.

**Для большинства из указанных команд требуется использование** `**sudo**`**, поскольку они выполняют операции, которые требуют прав администратора.**
<div class="page-break" style="page-break-before: always;"></div>
