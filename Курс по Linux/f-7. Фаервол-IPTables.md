Фаервол (firewall)

Типы фаерволов

IPTables

Настройка IPTables

### Фаервол (firewall)

Представляет собой сетевое устройство или программное обеспечение, которое контролирует и фильтрует трафик между сетями, разрешая или блокируя его в соответствии с определенными правилами безопасности. Основное назначение фаервола — обеспечивать защиту компьютерной сети от несанкционированного доступа и нежелательного сетевого трафика.

**Основные функции фаервола:**

1. **Блокирование несанкционированного доступа:** Фаервол может предотвращать несанкционированный доступ к сети или конкретным устройствам, защищая их от хакерских атак и нежелательного вторжения.
2. **Контроль и фильтрация трафика:** Фаервол анализирует сетевой трафик и принимает решения о блокировке или пропуске пакетов данных в соответствии с установленными правилами. Это позволяет фильтровать трафик на основе IP-адресов, портов и протоколов.
3. **Защита от вредоносного кода:** Фаерволы могут обнаруживать и блокировать попытки передачи вредоносных данных, таких как вирусы, трояны и другие вредоносные программы.
4. **Контроль и мониторинг сетевой активности:** Фаерволы предоставляют инструменты для мониторинга сетевой активности, что позволяет администраторам отслеживать и анализировать трафик, выявлять потенциальные угрозы и принимать меры предосторожности.
5. **Создание безопасных сетевых политик:** Администраторы могут настраивать правила фаервола в соответствии с требованиями безопасности организации, устанавливая политики доступа, блокировки и разрешения для конкретных приложений, услуг и устройств.
6. **Сегментация сети:** Фаерволы позволяют разделять сеть на сегменты и управлять трафиком между ними. Это помогает предотвратить распространение атак внутри сети.

### Типы фаерволов

**1. Аппаратные фаерволы:**

- Аппаратные фаерволы представляют собой физические устройства, обеспечивающие контроль и фильтрацию сетевого трафика на более низком уровне, чем программные фаерволы. Они обычно работают на основе специализированных микросхем и предназначены для обработки больших объемов трафика с высокой производительностью.
- Cisco ASA (Adaptive Security Appliance) — это пример аппаратного фаервола. Он предоставляет высокоуровневую безопасность для сетей и данных, поддерживая различные функции, такие как виртуальные частные сети (VPN), межсетевые экраны и протоколы безопасности.
- Другие аппаратные фаерволы: Huawei USG, Fortinet FortiGate, Palo Alto Networks NGFW

**2. Программные фаерволы:**

- Программные фаерволы — это программы, устанавливаемые на общих компьютерах или серверах, которые выполняют функции контроля трафика и фильтрации данных. Они могут быть установлены на серверах, персональных компьютерах или роутерах.
- Примеры программных фаерволов: IPTables, Firewalld

### IPTables

Это программный фаервол для систем, работающих на базе ядра Linux. Он предоставляет мощные средства для управления правилами фильтрации пакетов данных, проксирования портов и другими сетевыми функциями. IPTables может быть настроен для обеспечения безопасности на уровне ядра операционной системы.

`**sudo apt install iptables**` - команда для установки iptables.

`**sudo iptables -L**` - команда для просмотра текущих правил для iptables.

**Chains**

Цепочки (Chains) представляют собой организованные последовательности правил, определяющие, как должны обрабатываться пакеты сетевого трафика. Все пакеты, проходящие через систему, проходят через одну из трех основных цепочек: Input, Forward и Output.

1. `**Input**` **(Входящие):**
    
    Эта цепочка обрабатывает пакеты, предназначенные для самого хоста (системы, на которой выполняется iptables).
    
2. `**Forward**` **(Пересылка):**
    
    Эта цепочка обрабатывает пакеты, которые направляются через систему, а не для нее самой. Она используется в сетях с маршрутизацией, где пакеты пересылаются от одного узла к другому.
    
3. `**Output**` **(Исходящие):**
    
    Эта цепочка обрабатывает пакеты, исходящие из самого хоста.
    

Порядок правил в цепочках имеет значение. Правила обрабатываются сверху вниз, и при первом соответствии правилу выполнение последующих правил в цепочке прекращается.

Через цепочки iptables можно настраивать различные параметры трафика для каждой из трех основных цепочек.

1. **Source (Источник):** IP-адрес источника пакета.
2. **Destination (Назначение):** IP-адрес назначения пакета.
3. **Protocol (Протокол):** сетевой протокол, используемый в пакете (например, TCP, UDP, ICMP).
4. **Port (Порт):** порт отправителя или получателя в пакете.

### Настройка IPTables

Синтаксис команды:

```Shell
iptables command chain rule
```

Где:

- **command:** Действие, которое нужно выполнить (например, добавить правило `**-A**`, удалить `**-D**`, вставить `**-I**`, заменить `**-R**` и так далее.).
- **chain:** Целевая цепочка, в которой будет применено правило (например, `**INPUT**`, `**FORWARD**`, `**OUTPUT**`).
- **rule:** Спецификация правила, определяющая, какие пакеты будут соответствовать правилу.

**Основные команды:**

1. `**-L**` **(List):** Просмотреть текущие правила в цепочке или все цепочки.
    
    ```Shell
    sudo iptables -L
    ```
    
2. `**-F**` **(Flush):** Очистить все правила в указанной цепочке.
    
    ```Shell
    sudo iptables -F INPUT
    ```
    
3. `**-N**` **(New Chain):** Создать новую пользовательскую цепочку.
    
    ```Shell
    sudo iptables -N MYCHAIN
    ```
    
4. `**-X**` **(Delete Chain):** Удалить указанную цепочку.
    
    ```Shell
    sudo iptables -X MYCHAIN
    ```
    
5. `**-P**` **(Policy):** Установить политику по умолчанию для цепочки.
    
    ```Shell
    sudo iptables -P INPUT DROP
    ```
    
6. `**-A**` **(Append):** Добавить правило в конец указанной цепочки.
    
    ```Shell
    sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT
    ```
    
7. `**-I**` **(Insert):** Вставить правило в указанное место в цепочке.
    
    ```Shell
    sudo iptables -I INPUT 1 -p tcp --dport 22 -j ACCEPT
    ```
    
8. `**-D**` **(Delete):** Удалить указанное правило из цепочки.
    
    ```Shell
    sudo iptables -D INPUT -p tcp --dport 22 -j ACCEPT
    ```
    
9. `**-R**` **(Replace):** Заменить указанное правило в цепочке.
    
    ```Shell
    sudo iptables -R INPUT 1 -p tcp --dport 22 -j ACCEPT
    ```
    
10. `**-E**` **(Rename):** Переименовать пользовательскую цепочку.
    
    ```Shell
    sudo iptables -E OLDCHAIN NEWCHAIN
    ```
    
11. `**-Z**` **(Zero Counters):** Обнулить счетчики пакетов и байтов в правилах.
    
    ```Shell
    sudo iptables -Z
    ```
    

**Основные флаги для определения правил в цепочках iptables:**

1. `**-p**` **(Protocol):** Указывает на сетевой протокол, используемый в пакете (например, tcp, udp, icmp).
    
    ```Shell
    -p tcp   # Только TCP-пакеты
    ```
    
2. `**-sport**` **и** `**-dport**` **(Source/Destination Port):** Указывает на порт отправителя (`**-sport**`) или порт получателя (`**-dport**`) в пакете.
    
    ```Shell
    -dport 80   # Пакеты на порт 80 (HTTP)
    ```
    
3. `**-s**` **и** `**-d**` **(Source/Destination IP Address):** Указывают на IP-адрес отправителя (`**s**`) или IP-адрес получателя (`**d**`) в пакете.
    
    ```Shell
    -s 192.168.1.100   # Пакеты с IP-адреса 192.168.1.100
    ```
    
4. `**-j**` **(Jump):** Определяет, что делать с пакетами, соответствующими правилу (например, ACCEPT, DROP, REJECT).
    
    ```Shell
    -j ACCEPT   # Принять пакет
    ```
    
5. `**-m limit**` **(Limit):** Устанавливает ограничения на количество пакетов, которые могут соответствовать правилу в определенный период времени.
    
    ```Shell
    -m limit --limit 5/min --limit-burst 10   # Ограничить до 5 пакетов в минуту с бурстом до 10
    ```
    

  

> *_Эфемерные порты (или временные порты) - это динамически выделяемые порты, которые используются операционной системой для обеспечения временных сетевых соединений между клиентом и сервером. Обычно эфемерные порты присваиваются клиентским приложениям системой динамически во время установления соединения.  
>   
> Использование эфемерных портов предоставляет временные и уникальные идентификаторы портов для каждого соединения, что помогает в управлении соединениями на уровне операционной системы. После завершения соединения эфемерный порт возвращается в пул свободных портов и может быть повторно использован для других соединений.  
> _

<div class="page-break" style="page-break-before: always;"></div>
