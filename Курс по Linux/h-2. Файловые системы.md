Семейство систем ext

Структура хранения файла на Linux

Подключение нового раздела к файловой системе

Команды для проверки монтирования

Отключение монтирования

### Семейство систем ext

1. **extfs (Extended File System)**:
    - **Год выпуска**: 1992.
    - **Размер тома**: до 2 ГБ.
    - **Размер файла**: до 2 ГБ.
    - **Используется ли журнал**: Нет.
    - **Особенности**: Первая версия файловой системы для Linux, которая заменила минимальную файловую систему MINIX. Она поддерживала иерархическую структуру каталогов, атрибуты файлов и была более эффективной, чем MINIX.
2. **ext2 (Second Extended File System)**:
    - **Год выпуска**: 1993.
    - **Размер тома**: до 32 ТБ.
    - **Размер файла**: до 2 ТБ.
    - **Используется ли журнал**: Нет.
    - **Особенности**: ext2 была значительно улучшена по сравнению с extfs. Она поддерживала файлы до 2 ТБ, а также разделы до 32 ТБ. Однако отсутствие журналирования могло привести к длительным процессам восстановления после аварийного отключения.
3. **ext3 (Third Extended File System)**:
    - **Год выпуска**: 2001.
    - **Размер тома**: до 32 ТБ.
    - **Размер файла**: до 2 ТБ.
    - **Используется ли журнал**: Да.
    - **Особенности**: ext3 добавила журналирование, что значительно улучшило надежность файловой системы. Журналирование позволяло быстро восстанавливать файловую систему после сбоев, сокращая время восстановления по сравнению с ext2.
4. **ext4 (Fourth Extended File System)**:
    - **Год выпуска**: 2008.
    - **Размер тома**: до 1 ЭБ (экзабайт).
    - **Размер файла**: до 16 ТБ.
    - **Используется ли журнал**: Да.
    - **Особенности**: ext4 представляет собой значительное улучшение по сравнению с предыдущими версиями. Она поддерживает большие размеры томов и файлов, улучшенное журналирование (включая журналирование метаданных), а также улучшенную производительность и надежность. Кроме того, ext4 поддерживает фрагментацию и расширенные атрибуты файлов.

### Структура хранения файла на Linux

1. **iNode**:
    - iNode (индексный дескриптор) содержит метаданные файла, такие как разрешения доступа, владелец, группа, время создания, время последнего доступа и модификации, а также указатели на блоки данных файла.
    - Каждый файл в файловой системе имеет свой уникальный индексный дескриптор.
    - Inode хранится в специальной области файловой системы.
2. **Таблица соответствия имён**:
    - Когда создается директория, в нее добавляются записи, соответствующие именам файлов и номерам их iNode.
    - Директория представляет собой таблицу соответствия между именами файлов и их номерами iNode.
    - Когда вы обращаетесь к файлу по его имени, система ищет соответствующий индексный дескриптор (iNode) в этой таблице.
3. **Блоки данных**:
    - Реальное содержимое файла хранится в блоках данных.
    - Указатели на эти блоки данных хранятся в индексном дескрипторе (iNode).
    - Блоки данных могут быть разбросаны по различным местам на диске в зависимости от их размера и конкретной файловой системы.

### Подключение нового раздела к файловой системе

1. **Создание файловой системы:**
    
    Прежде всего, на созданном разделе необходимо создать файловую систему. Для большинства разделов Linux используется команда `**mkfs**` с указанием типа файловой системы (например, `**mkfs.ext4**` для файловой системы ext4).
    
    ```Shell
    sudo mkfs.ext4 /dev/sdXn
    ```
    
    Вместо `**/dev/sdXn**` используется путь к разделу.
    
2. **Создание точки монтирования:**
    
    После создания файловой системы необходимо указать место, где раздел будет доступен в файловой системе. Это место называется точкой монтирования. Можно выбрать любой пустой каталог в системе. Допустим, мы создаем точку монтирования в `**/mnt/mydisk**`.
    
    ```Shell
    mkdir /mnt/mydisk
    ```
    
3. **Монтирование раздела:**
    
    Теперь, когда у нас есть файловая система и точка монтирования, выполняем команду монтирования для подключения раздела.
    
    ```Shell
    sudo mount /dev/sdXn /mnt/mydisk
    ```
    
    Здесь `**/dev/sdXn**` - это название раздела, а `**/mnt/mydisk**` - точка монтирования.
    

После выполнения этих шагов раздел будет подключен и готов к использованию. Для автоматического монтирования при каждом запуске системы нужно добавить соответствующую запись в файл `**/etc/fstab**`.

`**echo "/dev/sdXn /mnt/mydisk ext4 rw 0 0" >> /etc/fstab**`

1. `**/dev/sdXn**`: Это путь к разделу, который вы хотите монтировать.
    - Можно использовать UUID раздела вместо пути `**/dev/sdXn**`. Это обеспечит уникальную идентификацию раздела и предотвратит ошибки монтирования в случае изменения порядка обнаружения устройств. Пример: `**UUID=XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX**`.
2. `**/mnt/mydisk**`: Это точка монтирования, куда будет подключен ваш раздел.
    - Можно выбрать любую другую пустую директорию в системе в качестве точки монтирования.
3. `**ext4**`: Это тип файловой системы раздела.
    - Вместо `**ext4**` можно использовать другие поддерживаемые типы файловых систем, такие как `**ext3**`, `**ntfs**`, `**vfat**` и т. д.
4. `**rw**`: Это опция, указывающая, что раздел должен быть доступен для чтения и записи.
    - Можно использовать `**ro**`, чтобы разрешить только чтение.
5. `**0**`: Это опция, которая указывает, нужно ли выполнять резервное копирование этого раздела при использовании утилиты `**dump**`.
    - Обычно используются значения 0 или 1, где 0 указывает, что резервное копирование не требуется, а 1 указывает, что резервное копирование должно выполняться.
6. `**0**`: Это опция, которая указывает, нужно ли проверять файловую систему при загрузке системы.
    - Обычно используются значения 0, 1 или 2. 0 указывает, что проверка не требуется, 1 указывает на проверку при загрузке, и 2 указывает на проверку после n загрузок или по времени.

### Команды для проверки монтирования

1. `**df -hP | grep /dev/sdb1**`:
    - Эта команда выводит информацию о доступном месте на диске для всех файловых систем в понятном для человека формате (`**h**`), а также форматирует результат в виде строк (`**P**`).
    - Если файловая система `**/dev/sdb1**` смонтирована, вы увидите строку с информацией о месте на диске для этой файловой системы.
2. `**mount | grep /dev/sdb1**`:
    - Эта команда отображает список всех монтированных файловых систем.
    - Если файловая система `**/dev/sdb1**` смонтирована, вы увидите строку с информацией о точке монтирования и параметрах монтирования.
3. `**cat /proc/mounts | grep /dev/sdb1**`:
    - Эта команда читает информацию о текущих монтированиях из файла `**/proc/mounts**`, который содержит список всех смонтированных файловых систем в системе.
    - Если файловая система `**/dev/sdb1**` смонтирована, вы увидите строку с информацией о точке монтирования и параметрах монтирования.

### Отключение монтирования

Команда `**umount**` используется для отключения (размонтирования) файловых систем. Основный синтаксис:

```Shell
umount [опции] <точка_монтирования>
# точка монтирования - путь к точке монтирования файловой системы, которую вы хотите отмонтировать.
```

**Опции**:

- `**-a**`: Размонтировать все смонтированные файловые системы, перечисленные в файле `**/etc/mtab**`.
- `**-l**` **или** `**-lazy**`: Выполнить ленивое (легкое) размонтирование. Это позволяет файловой системе оставаться доступной для текущих операций, но отключается, как только она перестает быть занятой.
- `**-n**` **или** `**-no-mtab**`: Не обновлять файл `**/etc/mtab**` после успешного размонтирования.
- `**-r**` **или** `**-read-only**`: Размонтировать файловую систему в режиме "только для чтения".
- `**-t <type>**`: Размонтировать только файловые системы указанного типа (например, `**ext4**`, `**ntfs**`, `**iso9660**` и т.д.).
- `**-v**` **или** `**--verbose**`: Вывести более подробную информацию о выполняемых действиях.
<div class="page-break" style="page-break-before: always;"></div>
