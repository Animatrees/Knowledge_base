RPM (RPM Package Manager)

Где хранится и как используется база данных RPM

Основные команды для работы с базой данных RPM

Недостатки RPM

YUM (Yellowdog Updater Modified)

Сравнение YUM и RPM

Как добавить в YUM новый репозиторий

Последовательность шагов при установке пакета

Основные команды для работы с YUM

### **RPM (RPM Package Manager)**

- **Используется в:** Red Hat Enterprise Linux (RHEL), Fedora, CentOS и их производных дистрибутивах.
- **Описание:** RPM - это формат пакета и система управления пакетами для дистрибутивов Linux, основанных на Red Hat. Он использует формат RPM для упаковки программ и управления ими.

### Где хранится и как используется база данных RPM

База данных RPM (RPM Database) содержит информацию о всех установленных пакетах и их файловой структуре. В системах, использующих формат пакетов RPM (например, в дистрибутивах на основе Red Hat, CentOS, Fedora), эта база данных играет ключевую роль в управлении пакетами.

1. **Местоположение базы данных RPM:**
    - Фактическое местоположение базы данных может различаться в различных дистрибутивах. Однако, обычно, она располагается в подкаталоге `**/var/lib/rpm/**`. В этой директории находятся несколько файлов, включая `**Packages**`, который содержит основную информацию о пакетах.
2. **Структура базы данных RPM:**
    - `**Packages**`: Основной файл базы данных, содержащий информацию о каждом установленном пакете, включая его имя, версию, зависимости, файлы и другие атрибуты.
    - `**Dirnames**` и `**Basenames**`: Файлы, содержащие индексы имен файлов, используемые для быстрого поиска.
3. **Инструменты для работы с базой данных RPM:**
    - Команды, такие как `**rpm**`, `**yum**` и `**dnf**`, используют базу данных RPM для выполнения операций установки, обновления, удаления и запроса информации о пакетах.
4. **Как используется:**
    - При установке или удалении пакета, информация об этом изменении сохраняется в базе данных RPM.
    - При выполнении команд для управления пакетами, системные инструменты обращаются к базе данных, чтобы получить информацию о текущем состоянии системы.
5. **Восстановление базы данных:**
    - Иногда база данных RPM может повреждаться. Для восстановления её целостности можно использовать команду `**rpm --rebuilddb**`.

### Основные команды для работы с базой данных RPM

1. **Установка (Install)** - `**rpm -ivh пакет.rpm**`.  
    Эта команда устанавливает указанный пакет. i - установка, v - подробный вывод, h - вывод хэшей.  
    
2. **Удаление (Erase)** - `**rpm -e название_пакета**`.  
    Эта команда удаляет установленный пакет.  
    
3. **Обновление (Update)** - `**rpm -U пакет.rpm**`.  
    Эта команда обновляет уже установленный пакет до новой версии, если такая доступна.  
    
4. **Проверка установленных пакетов (Query All)** - `**rpm -qa**`.  
    Эта команда выводит список всех установленных пакетов.  
    
5. **Поиск пакета (Query)** - `**rpm -q пакет**`.  
    Эта команда проверяет, установлен ли указанный пакет.  
    
6. **Информация о пакете (Query Information)** - `**rpm -qi название_пакета**`.  
    Эта команда предоставляет информацию о версии, описании и других деталях пакета.  
    
7. **Проверка целостности файлов пакета (Verify)** - `**rpm -V название_пакета**`.  
    Эта команда проверяет целостность файлов, входящих в состав пакета.  
    

### Недостатки RPM

1. **Зависимости:**
    
    RPM может столкнуться с проблемами разрешения зависимостей при установке или обновлении пакетов. Некоторые пакеты требуют определенных версий других пакетов, и это может создавать конфликты.
    
2. **Отсутствие автоматического обновления зависимостей:**
    
    В отличие от некоторых более современных систем управления пакетами, RPM не всегда автоматически обновляет зависимости. Это может требовать более активного управления пользователем для установки и обновления пакетов.
    
3. **Нет системного уведомления о новых версиях пакетов:**
    
    RPM по умолчанию не предоставляет системных уведомлений о наличии обновлений. Пользователю может быть сложно следить за актуальностью пакетов и обновлять их своевременно.
    
4. **Отсутствие функциональности "роллбэк":**
    
    RPM не всегда предоставляет простой механизм отката изменений после установки или обновления пакета. В случае проблем с новой версией пакета может потребоваться более сложная процедура восстановления.
    
5. **Недостаточная поддержка конфигураций:**
    
    У RPM не всегда достаточно механизмов для управления изменениями в конфигурационных файлах в процессе обновления. Это может привести к конфликтам при обновлении, особенно если пользователь вносил изменения в конфигурацию.
    

---

### **YUM (Yellowdog Updater Modified)**

Это высокоуровневый интерфейс для RPM, который обрабатывает установку, удаление и обновление пакетов, а также управляет их зависимостями. YUM также поддерживает добавление репозиториев.

### Сравнение YUM и RPM

1. **Работа с зависимостями:**
    - **RPM:** Низкоуровневый инструмент. При установке или обновлении пакета не автоматически удовлетворяет его зависимости, что может привести к сложностям.
    - **YUM:** Автоматическое разрешение зависимостей. YUM самостоятельно устанавливает или обновляет все необходимые зависимости для выбранных пакетов.
2. **Управление репозиториями:**
    - **RPM:** Требует ручного добавления и удаления репозиториев.
    - **YUM:** Позволяет управлять репозиториями более удобным способом. Можно добавлять, удалять и настраивать репозитории без необходимости редактировать конфигурационные файлы.
3. **Групповые операции:**
    - **RPM:** Работает с отдельными пакетами.
    - **YUM:** Поддерживает групповые операции, позволяя устанавливать, обновлять или удалять группы связанных пакетов, что удобно для управления приложениями или службами.
4. **Метаданные репозиториев:**
    - **RPM:** Требует ручного обновления метаданных о пакетах.
    - **YUM:** Автоматически обновляет метаданные репозиториев, что обеспечивает актуальную информацию о наличии пакетов.
5. **Удобство использования:**
    - **RPM:** Требует более детальной работы с конфигурацией и управлением пакетами.
    - **YUM:** Предоставляет удобный и интуитивно понятный интерфейс, сокращая необходимость вручную управлять многими аспектами установки и обновления пакетов.

### Как добавить в YUM новый репозиторий

1. **Создаем файл репозитория:**
    - Создаём новый файл с расширением `**.repo**` в директории `**/etc/yum.repos.d/**`. Например, `**nginx.repo**`.
        
        ```Shell
        sudo touch /etc/yum.repos.d/nginx.repo
        ```
        
2. **Открываем файл для редактирования:**
    - Используем текстовый редактор, такой как `**nano**` или `**vim**`, чтобы открыть только что созданный файл репозитория.
        
        ```Shell
        sudo nano /etc/yum.repos.d/nginx.repo
        ```
        
3. **Добавляем информацию о репозитории:**
    - В открытом файле добавим следующую информацию о репозитории для Nginx. 
        
        ```Plain
        [nginx]
        name=nginx repo
        baseurl=https://nginx.org/packages/centos/$releasever/$basearch/
        gpgcheck=1
        enabled=1
        gpgkey=https://nginx.org/keys/nginx_signing.key
        
        ```
        
        - `**name**`: Название репозитория.
        - `**baseurl**`: URL для загрузки пакетов. Здесь используется пример для CentOS 7, замените на соответствующий URL для вашего дистрибутива.
        - `**gpgcheck**`: Проверять подписи GPG при установке пакетов (1 - да, 0 - нет).
        - `**enabled**`: Включить репозиторий (1 - да, 0 - нет).
        - `**gpgkey**`: URL для ключа GPG.
4. **Сохраняем и закрываем файл:**
    - Сохраните внесенные изменения и закройте текстовый редактор.
5. **Обновляем кэш YUM:**
    - Обновим кэш метаданных YUM, чтобы система узнала о новом репозитории.
        
        ```Shell
        sudo yum makecache
        ```
        

### Последовательность шагов при установке пакета

1. **Проверка доступности репозиториев:**
    - YUM начинает с проверки доступности всех указанных репозиториев. Если какой-то из репозиториев недоступен, операция может завершиться ошибкой.
2. **Получение метаинформации о пакетах:**
    - YUM загружает метаинформацию о пакетах из репозиториев. Эта информация включает в себя списки доступных пакетов, их версии, зависимости и другие детали.
3. **Проверка транзакции:**
    - YUM анализирует запрошенные операции, такие как установка или обновление пакета, и проверяет их наличие и соответствие системе. Также проверяются зависимости, чтобы убедиться, что они будут разрешены.
4. **Отображение сводки транзакции:**
    - YUM выводит сводку предстоящей транзакции, включая список пакетов, которые будут установлены, обновлены или удалены. Также отображается объем памяти, который потребуется для проведения транзакции.
5. **Подтверждение установки:**
    - Пользователю предоставляется сводка транзакции, и ему задается вопрос: "Is this ok [y/d/N]?" Пользователь может подтвердить или отклонить операцию, а также выбрать альтернативные варианты.
6. **Скачивание и установка пакета:**
    - Если пользователь подтверждает транзакцию, YUM начинает скачивание пакетов, после чего они устанавливаются на систему. Этот процесс включает в себя загрузку необходимых зависимостей и установку всех выбранных пакетов.

### Основные команды для работы с YUM

1. `**yum repolist**`:
    - Команда `**yum repolist**` выводит список доступных репозиториев и количество пакетов в каждом репозитории. Это позволяет пользователям оценить актуальность и наличие пакетов в системе.
2. `**yum provides command_name**`:
    - Команда `**yum provides**` позволяет определить, из какого пакета (репозитория) происходит указанная команда. Например, `**yum provides ls**` покажет, из какого пакета получается утилита `**ls**`.
3. `**yum install package_name**`:
    - Команда `**yum install**` используется для установки указанного пакета и всех его зависимостей. Например, `**yum install nano**` установит текстовый редактор Nano.
4. `**yum remove package_name**`:
    - Команда `**yum remove**` служит для удаления указанного пакета из системы. Например, `**yum remove nano**` удалит установленный пакет Nano.
5. `**yum update package_name**`:
    - Команда `**yum update**` обновляет указанный пакет до последней доступной версии, а также обновляет его зависимости.
6. `**yum update**`:
    - Команда `**yum update**` обновляет все установленные пакеты в системе до их последних версий.

Дополнительные полезные команды:

- `**yum search keyword**`:
    - Команда `**yum search**` позволяет искать пакеты по ключевым словам. Например, `**yum search text-editor**` выведет пакеты, связанные с текстовыми редакторами.
- `**yum list installed**`:
    - Команда `**yum list installed**` выводит список всех установленных пакетов в системе.
- `**yum info package_name**`:
    - Команда `**yum info**` предоставляет подробную информацию о конкретном пакете, включая его версию, размер, описание и зависимости.
<div class="page-break" style="page-break-before: always;"></div>
