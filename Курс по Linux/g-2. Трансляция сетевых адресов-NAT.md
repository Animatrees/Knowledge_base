NAT

Процедура отправки пакета (LAN to WAN)

### NAT

Это технология, используемая в сетях для преобразования IP-адресов и портов между устройствами внутри локальной сети (LAN) и внешней сети, такой как интернет. Основная цель NAT - обеспечение связи устройств внутри локальной сети с устройствами во внешних сетях, используя ограниченный набор публичных IP-адресов.

**Публичный адрес (Public Address):**

- Публичный IP-адрес — это уникальный идентификатор, который присваивается устройству и используется для идентификации этого устройства в глобальной сети.
- Этот IP-адрес виден внешним сетям и уникален для каждого устройства в глобальной сети.
- Публичные IP-адреса могут использоваться для доступа к устройствам извне.

**Частный адрес (Private Address):**

- Частный IP-адрес — это адрес, предназначенный для использования в локальных сетях (например, в домашних или офисных сетях).
- Частные IP-адреса используются внутри локальной сети и не являются уникальными в глобальном масштабе. Такие адреса предназначены для использования внутри конкретной сети и не маршрутизируются через интернет.

### Процедура отправки пакета (LAN to WAN)

1. **Преобразование IP-адресов:** Когда устройство в локальной сети отправляет запрос во внешнюю сеть, NAT преобразует его локальный IP-адрес в общедоступный (публичный) IP-адрес, присвоенный маршрутизатору.
2. **Преобразование портов:** Каждое устройство в локальной сети имеет уникальный порт. NAT также преобразует порты для отслеживания, какому устройству принадлежит каждый запрос. Это позволяет обеспечить множественные соединения из локальной сети с использованием одного публичного IP-адреса.
3. **Таблица преобразований:** Маршрутизатор, выполняющий NAT, поддерживает таблицу преобразований, в которой отображаются соответствия между локальными и публичными IP-адресами, а также преобразованными портами.
4. **Обратное преобразование:** При возврате ответного трафика из внешней сети маршрутизатор NAT использует таблицу преобразований для перевода публичного адреса и порта обратно в соответствующий локальный адрес и порт.

Команда `**iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -j MASQUERADE**` используется для настройки правила в таблице NAT в iptables на Linux.

- `**-t nat**`: Указывает, что мы работаем с таблицей NAT. В Linux iptables существует несколько таблиц, и "nat" используется для настройки правил Network Address Translation (NAT).
- `**-A POSTROUTING**`: Определяет, что правило применяется к цепочке POSTROUTING. Цепочка POSTROUTING обрабатывает пакеты после того, как они были маршрутизированы.
- `**-s 192.168.1.0/24**`: Устанавливает исходный IP-адрес или диапазон адресов, для которых будет применяться данное правило. В данном случае, это сеть 192.168.1.0/24.
- `**-j MASQUERADE**`: `**MASQUERADE**` используется для динамического изменения исходного IP-адреса отправителя на IP-адрес интерфейса, через который пакет покидает сеть (часто используется для скрытия локальных сетей за одним публичным IP-адресом).

Команда `**ping**` используется для проверки доступности узла в сети и измерения времени, необходимого для отправки и получения ответа от этого узла. Она отправляет ICMP эхо-запросы (ping) на указанный узел и ожидает ответа.

**Основные опции:**

- `**-c**` (count): Ограничивает количество отправляемых запросов.
- `**-i**` (interval): Устанавливает интервал между запросами.
- `**-s**` (size): Задает размер пакета данных.
- `**-t**` (timeout): Устанавливает время ожидания ответа.

`**tcpdump**` — это утилита командной строки, предназначенная для анализа и отображения сетевого трафика. Она способна захватывать и анализировать пакеты, проходящие через сетевой интерфейс.

**Основные опции:**

- `**-l**` - указывает `**tcpdump**` выводить данные по мере их поступления, вместо буферизации.
- `**-i --interface**`: Задает интерфейс для захвата трафика.
- `**-n**`: Отображает IP-адреса и порты в числовом формате.
- `**-X**`: Отображает данные пакетов в шестнадцатеричном и ASCII форматах.
- **`-s --snapshot-length`**: Задает максимальную длину захватываемых пакетов.
<div class="page-break" style="page-break-before: always;"></div>
